<!DOCTYPE html>
<html>
	<head>
		<title>New York Times Daily Crossword</title>
		<meta name="GENERATOR" content="Microsoft Visual Studio .NET 7.1">
		<meta name="vs_targetSchema" content="http://schemas.microsoft.com/intellisense/ie5">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="viewport" content="initial-scale=1">

		<style type="text/css">
			*{user-select:none;cursor: default;}
			.vblack {background-color:#000000;visibility:visible;}
			.num{height:6pt;font-family:arial;font-size:6pt;visibility:visible}
			.letter{height:100%;width:100%;font-family:helvetica;font-size:8pt;text-align:center;display:none;}
			.bigcircle, .bigshade{background-color: silver;}
			.subst{font-family:verdana;font-size:8pt;text-align:center;display:none;}
			.subst2{font-family:verdana;font-size:6pt;text-align:center;display:none;}
			.copy{font-family:Arial;font-weight:bold;font-size:7pt}

			.PuzTable {margin-bottom:0px;border-collapse:collapse;}
			.PuzTable td {vertical-align:top;height:14px;width:14px;border:1px solid black;padding:0px;}
			.PuzTitle, .CPHContent_Copyright{font-family:Arial;font-weight:normal;font-size:8pt;}
			.puzzle-selection
			{
				z-index:1000;
				width:250px;
				font-family:Arial;
				font-size:9pt;
				background-color:white;
				border:1px solid black;
				padding:5px;
				margin-bottom:10px;
				box-shadow: 5px 5px 5px gray;
			}
			.puzzle-selection *{vertical-align: middle;}
			.puzzle-selection .date-picker{width: 105px;}
			.puzzle-selection .ctrl-container{margin-top:5px;}
			.puzzle-clues a{display:none;}
			.puzzle-clues-across, .puzzle-clues-down
			{
				display:inline-block;
				vertical-align:top;
				margin-right:10px;
				max-width:2.5in;
				font-family:Arial;
				font-size:8pt;
			}

			.puzzle-across-header, .puzzle-down-header
			{
				font-size:9pt;
				font-weight:bold;
			}

			#dlgPuzzSel
			{
				z-index:1000;
				width:300px;
				font-family:Arial;
				font-size:8pt;
				background-color:white;
				border:1px solid black;
				padding:7px;
				margin-bottom:10px;
				box-shadow: 5px 5px 5px gray;
			}

			.puzzle-container
			{
				margin-bottom:10px;
			}

			@media print
			{
				#dlgPuzzSel{display: none;}
			}
			@media print and (orientation: portrait)
			{
			}
			@media print and (orientation: landscape)
			{
				.puzzle-page-container
				{
					margin-top: 24pt;
				}

				.puzzle-container
				{
					float:left;
					margin-right:25px;
				}
				.puzzle-container-clues-left
				{
					float:right;
					margin-left:25px;
				}
			}
		</style>

		<link rel="stylesheet" href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.11.4/themes/smoothness/jquery-ui.css">
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.js"></script>
		<script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.11.4/jquery-ui.js"></script>

		<link rel="stylesheet" href="../widget_box/widget_box.css">
		<script src="../widget_box/widget_box.js"></script>

		<script type="text/javascript">
			sprintf = function (sPattern, args) {
				var _args = arguments;
				return sPattern && sPattern.replace(/\%(\d+)/g, function (s, n) {
					return _args[n];
				});
			};
			$(function()
			{
				var curAjax = null;
				function LoadPuzzle(date)
				{
					var date = date || $("#puzzDate").datepicker("getDate");
					var strParm = sprintf("http://www.xwordinfo.com/Crossword?date=%1", $.datepicker.formatDate("mm/dd/yy", date));
					var strUri = $("#proxyServer").prop("value");
					switch(strUri)
					{
						case "proxy.jsp": strUri = "http://jah:8080/ibi_apps/tools/jahtest/nyxword/proxy.jsp?" + strParm;break;
						case "proxy.server.js": strUri = "http://jah:8000/proxy?uri=" + strParm;break;
						case "none": strUri = strParm;
					}

					//Kill any current ajax request.
					(curAjax && curAjax.abort());
					curAjax = $.ajax(
					{
						"url": strUri,
						"dataType":"html",
						"beforeSend":function(xhr, settings)
						{
							$(".puzzle-container").html("<img src='./loader.gif'>");
							$(".puzzle-clues").css("display", "none");
						},
						"success":function(puzzlePage, status, xhr)
						{
							puzzlePage = puzzlePage.replace(/ : <a/g, "<a");
							console.log(puzzlePage);
							var $puzzPage = $(puzzlePage);
							var $puzzTab = $puzzPage.find("#PuzTable");
							var $puzzTitle = $puzzPage.find("#CPHContent_TitleLabel").addClass("PuzTitle");
							var $puzzCRight = $puzzPage.find("#CPHContent_Copyright").addClass("CPHContent_Copyright");
							var $puzzSelection = $(".puzzle-selection");
							var $puzzContainer = $(".puzzle-container").empty().append($puzzTitle, $puzzTab, $puzzCRight);
							var $puzzPageContainer = $(".puzzle-page-container");
							var $puzzAcrossHeader = $(".puzzle-across-header").detach();
							var $puzzDownHeader = $(".puzzle-down-header").detach();
							var $puzzClues = $(".puzzle-clues").css("display", "block").draggable();
							var $cluesAcross = $(".puzzle-clues-across").empty().append($puzzAcrossHeader, $puzzPage.find("#CPHContent_AcrossClues"));
							var $cluesDown = $(".puzzle-clues-down").empty().append($puzzDownHeader, $puzzPage.find("#CPHContent_DownClues"));

							$("#showAnswers").prop("checked", false);
							$("#makeDiagramless").prop("checked", false);
							$("#gridSize").trigger("change");
						
							if(!$puzzTab.length)
							{
								var str = "DID YOU FORGET TO TURN OFF PK VALIDATION?!...<p><p><h1>SERVER RESPONSE:</h1><p>" + xhr.responseText;
								$(document.documentElement).html(str);
							}
						},
						"error":function(xhr, strError, strMessage)
						{
							$(".puzzle-container").html(xhr.responseText || strMessage || "Unknown AJAX error retrieving puzzle.");
						}
					});
				}



				var date = new Date();
				$("#puzzDate").datepicker().datepicker("setDate", date).on("change", function(e)
				{
					var date = $(e.target).datepicker("getDate");
					LoadPuzzle(date);
				});
				LoadPuzzle(date);

				$("#proxyServer").on("change", function(e)
				{
					LoadPuzzle(date);
				});

				$("#makeDiagramless").on("change", function(e)
				{
					$(".vblack").css("backgroundColor", (this.checked) ? "white" : "black");
					var idx = $(".num").css("color", (this.checked) ? "white" : "black").index();
				});
				
				$("#showAnswers").on("change", function(e)
				{
					$(".letter, .subst, .subst1").css("display", (this.checked) ? "inherit" : "none");
				});

				$("#btnPuzzPrint").on("click", function(e)
				{
					if(e.ctrlKey)
						LoadPuzzle();
					else
					{
						var puzzContainer = $(".puzzle-container");
						if($("#btnCluesOnRight").prop("checked"))
							puzzContainer.removeClass("puzzle-container-clues-left");
						else
							puzzContainer.addClass("puzzle-container-clues-left");
						window.print();
					}
				});

				var dlgPuzzSel = $("#dlgPuzzSel").draggable();
				var proxyServerLabel = $("#proxyServerLabel").css({"min-width":"70px"});
				var puzzDateLabel = $("#puzzDateLabel").css({"min-width":"70px"});
				var boxProxyOptions = $("#boxProxyOptions").css("marginBottom", "7px");
				var boxDateOptions = $("#boxDateOptions").css({"marginBottom":"7px", "border":"0px solid red"});
				var proxyServer = $("#proxyServer");
				var puzzDate = $("#puzzDate").css({"minWidth":"20px", "marginRight":"7px"});
				var puzzPrint = $("#btnPuzzPrint");
				var boxMoreOptions = $("#boxMoreOptions").css({"border":"0px solid green"});
				var showAnswersLabel = $("#showAnswersLabel").css({"margin-right": "7px"});
				var puzzGridSizeLabel = $("#gridSizeLabel").css({"min-width":"70px"});
				var puzzGridSize = $("#gridSize").prop("value", "20px").css({"width":"40px", "text-align":"center"}).on("change", function(e)
				{
					var gridSize = parseInt($("#gridSize").prop("value"), 10) + "px";
					$(".PuzTable td").css({"width": gridSize, "height": gridSize});
					$(this).prop("value", gridSize);
				});
				var cluesOnRight = $("#btnCluesOnRight").prop("checked", true);
			});
		</script>
	</head>
	<body>
		<div class="puzzle-page-container">
			<div id="dlgPuzzSel" data-role-flex="box" data-flex-direction="column" data-flex-justify="center" data-flex-align-items="stretch">
				<div id="boxDateOptions" data-role-flex="box, item" data-flex-grow="1" data-flex-align-items="center">
					<label id="puzzDateLabel" for="puzzDate" data-role-flex="item">Puzzle Date:</label>
					<input id="puzzDate" data-role-flex="item" data-flex-shrink="1" data-flex-grow="1" type="text" readonly="">
					<button id="btnPuzzPrint" data-role-flex="item">Print...</button>
				</div>
				<div id="boxProxyOptions" data-role-flex="box, item" data-flex-grow="1" data-flex-align-items="center">
					<label id="proxyServerLabel" for="proxyServer" data-role-flex="item">Proxy Server:</label>
					<select id="proxyServer" data-role-flex="item" data-flex-shrink="1" data-flex-grow="1">
						<option value="proxy.jsp">Apache (proxy.jsp:8080)</option>
						<option value="proxy.server.js" selected>Node.js (proxy.server.js:8000)</option>
						<option value="none">None (Prolly won't work!)</option>
					</select>
				</div>
				<div id="boxMoreOptions" data-role-flex="box, item" data-flex-grow="1" data-flex-align-items="center">
					<label id="gridSizeLabel" for="gridSize" data-role-flex="item">Grid Size:</label>
					<input id="gridSize" data-role-flex="item" type="text">

					<div data-role-flex="item" data-flex-grow="1"></div>

					<input id="showAnswers" type="checkbox" data-role-flex="item"/>
					<label id="showAnswersLabel" for="showAnswers" data-role-flex="item">Anwsers</label>
					<input id="makeDiagramless" type="checkbox" data-role-flex="item"/>
					<label for="makeDiagramless" data-role-flex="item">Diagramless</label>
				</div>
				<div id="boxYetMoreOptions" data-role-flex="box, item" data-flex-grow="1" data-flex-justify="end" data-flex-align-items="center">
					<input id="btnCluesOnRight" type="checkbox" data-role-flex="item"/>
					<label for="btnCluesOnRight" data-role-flex="item">Landscape Clues on Right</label>
				</div>
			</div>

			<div class="puzzle-container">
			</div>

			<div class="puzzle-clues">
				<div class="puzzle-clues-across">
					<div class="puzzle-across-header">Across</div>
				</div>
				<div class="puzzle-clues-down">
					<div class="puzzle-down-header">Down</div>
				</div>
			</div>
		</div>
	</body>
</html>

